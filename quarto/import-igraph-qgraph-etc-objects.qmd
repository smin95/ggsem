---
format: html
editor: visual
---

# Integrated Network Workflow {#sec-intro}

The `ggsem` package also provides direct integration with multiple network object types, allowing you to launch the application with pre-loaded models and visualizations. Here, I demonstrate how one object can be pre-loaded before launching the app. If you are interested in pre-loading multiple objects, see the next section of the book.

#### Purpose of this workflow: {.unnumbered}

If you want to modify aesthetics using interactive parameter visualization (dynamic dropdown of all nodes and edges etc), then you should pre-load output objects from other packages into `ggsem`.

#### Note: {.unnumbered}

For all, `object` argument must be specified to either `igraph`, `qgraph` or `network` object, with no `model` argument in `ggsem()`.

## 1. Loading `igraph` objects {.unnumbered}

The `ggsem` package provides support for `igraph` objects for plotting networks.

### Direct igraph Object Import {.unnumbered}

Load igraph networks directly into `ggsem` for interactive visualization and customization:

```{r}
#| message: false
#| warning: false
library(igraph)
library(ggsem)

set.seed(2026)
# Create a sample ring graph
g <- make_ring(10)

# Verify object class
class(g)  # Returns "igraph"
```

```{r}
#| eval: false
# Import directly into ggsem
ggsem(object = g, width = 35, height = 35)
```

```{r}
#| echo: false
#| fig-cap: "Figure 1. A network diagram generated from pre-loaded igraph object"
#| fig-align: "center"
#| out.width: "70%"
knitr::include_graphics("network_preload/fig1.png")
```

### Practical Examples with Realistic Networks {.unnumbered}

#### Social Network Analysis {.unnumbered}

```{r}
#| message: false
#| warning: false
#| fig-width: 5
#| fig-height: 5
#| fig-align: center

set.seed(2026)
# Create a social network with attributes
social_g <- make_graph(~ Alice-Bob, Bob-Charlie, Charlie-David, 
                       David-Eve, Eve-Alice, Alice-Charlie,
                       Bob-David)

# Add vertex attributes
V(social_g)$name <- c("Alice", "Bob", "Charlie", "David", "Eve")
V(social_g)$group <- c("A", "A", "B", "B", "A")
V(social_g)$centrality <- degree(social_g)

# Add edge attributes  
E(social_g)$weight <- c(1, 2, 1, 3, 2, 1, 1)
E(social_g)$type <- c("friend", "colleague", "friend", "family", 
                      "friend", "colleague", "friend")

plot(social_g)
```

```{r}
#| eval: false
# Import to ggsem with attributes preserved
ggsem(object = social_g)
```

```{r}
#| echo: false
#| fig-cap: "Figure 2. A network diagram generated from pre-loaded igraph object"
#| fig-align: "center"
#| out.width: "55%"
knitr::include_graphics("network_preload/fig2.png")
```

#### Weighted Network with Community Structure {.unnumbered}

```{r}
#| message: false
#| warning: false
#| fig-width: 5
#| fig-height: 5
#| fig-align: center
# Create a weighted network with clear community structure
set.seed(123)
weighted_g <- sample_sbm(
  n = 12,
  pref.matrix = matrix(c(0.8, 0.1, 0.1, 0.8), nrow = 2),
  block.sizes = c(6, 6),
  directed = FALSE
)

# Add edge weights
E(weighted_g)$weight <- round(runif(ecount(weighted_g), 0.1, 1), 2) # limit decimal places, otherwise they clutter the overall visuals

plot(weighted_g)
```

```{r}
#| eval: false
# Import for interactive refinement
ggsem(object = weighted_g, width = 45, height = 45)
```

```{r}
#| echo: false
#| fig-cap: "Figure 3. A network diagram generated from pre-loaded igraph object. Gradient colors have been applied to nodes in the app. Layouts of the three diagrams have been matched."
#| fig-align: "center"
#| out.width: "70%"
knitr::include_graphics("network_preload/fig3.png")
```

#### Comparison of Networks Across Time {.unnumbered}

You can also match the layout across network diagrams in the `ggsem` app.

```{r}
#| message: false
#| warning: false
#| fig-align: center
library(igraph)
library(ggsem)

set.seed(2025)

# Same 5 researchers across all time points
nodes <- data.frame(id = 1:5, name = c("Alice", "Bob", "Charlie", "Diana", "Eve"))

# Time 1: Early collaborations (2018-2019)
edges_t1 <- data.frame(
  from = c(1, 1, 2, 3, 4),
  to = c(2, 3, 3, 4, 5),
  weight = c(2, 1, 1, 1, 1),
  year = "2018-2019"
)

# Time 2: Growing collaborations (2020-2021)
edges_t2 <- data.frame(
  from = c(1, 1, 2, 2, 3, 4, 4),
  to = c(2, 3, 3, 4, 4, 5, 1),
  weight = c(4, 3, 2, 2, 3, 2, 1),
  year = "2020-2021"
)

# Time 3: Established network (2022-2023)
edges_t3 <- data.frame(
  from = c(1, 1, 2, 2, 3, 3, 4, 4, 5),
  to = c(2, 3, 3, 4, 4, 5, 5, 1, 2),
  weight = c(7, 5, 4, 3, 5, 3, 4, 2, 2),
  year = "2022-2023"
)

# Create three separate igraph objects
g1 <- graph_from_data_frame(edges_t1, vertices = nodes, directed = FALSE)
g2 <- graph_from_data_frame(edges_t2, vertices = nodes, directed = FALSE)
g3 <- graph_from_data_frame(edges_t3, vertices = nodes, directed = FALSE)

fixed_layout <- layout_nicely(g3)

par(mfrow = c(1, 3))
plot(g1, layout = fixed_layout, main = "Time 1: 2018-2019",
     edge.width = E(g1)$weight, edge.label = E(g1)$weight)
plot(g2, layout = fixed_layout, main = "Time 2: 2020-2021",
     edge.width = E(g2)$weight, edge.label = E(g2)$weight)
plot(g3, layout = fixed_layout, main = "Time 3: 2022-2023",
     edge.width = E(g3)$weight, edge.label = E(g3)$weight)

```

```{r}
#| eval: false
# Import for interactive refinement
ggsem_builder() |>
    add_group("First", object = g1, x = -40, width = 25, height = 25) |>
    add_group("Second", object = g2, x = 0, width = 25, height = 25) |>
    add_group("Third", object = g3, x = 40, width = 25, height = 25) |>
    launch()
```

```{r}
#| echo: false
#| fig-cap: "Figure 3. A network diagram generated from pre-loaded igraph object. Gradient colors have been applied to nodes in the app."
#| fig-align: "center"
#| out.width: "90%"
knitr::include_graphics("network_preload/network_multi.png")
```

## Preserved igraph Features {.unnumbered}

### Network Properties Maintained: {.unnumbered}

-   **Vertex attributes**: names, groups, centrality measures

-   **Edge attributes**: weights, types, directions

-   **Graph structure**: community detection, clustering coefficients

-   **Layout information**: when specified in igraph

-   **Bipartite structure**: type attributes and two-mode organization

### Bipartite-Specific Preservation: {.unnumbered}

-   **Vertex types** and partition membership automatically detected

-   **Bipartite layout** maintained with clear separation between partitions

-   **Type-based coloring** options for different entity classes in the app

## Relative Layout Integration

### Preserving igraph Layouts: {.unnumbered}

```{r}
# Use igraph's layout algorithms
set.seed(2026)
g <- make_star(10)

# Calculate layout in igraph
layout_ig <- layout_with_fr(g)

plot(g)
```

```{r}
#| eval: false
# Import to ggsem with layout preserved
ggsem(object = g, width = 35, height = 35)  # Relative layout automatically transferred
```

While the individual node's location may differ due to differences in random seeds between inside and outside the `ggsem` app, the overall layout is preserved.

```{r}
#| echo: false
#| fig-cap: "Figure 4. A network diagram generated from pre-loaded igraph object with pre-specified layout."
#| fig-align: "center"
#| out.width: "70%"
knitr::include_graphics("network_preload/fig5.png")
```

## Weight and Attribute Visualization

### Automatic Weight Mapping: {.unnumbered}

```{r}
# Edge weights automatically inform visualization
weighted_net <- make_full_graph(5)
E(weighted_net)$weight <- c(1, 2, 3, 4, 5, 3, 2, 4, 1, 5)

plot(weighted_net)
```

```{r}
#| eval: false
# In ggsem: weights can control edge width, color, or transparency
ggsem(object = weighted_net, width = 35, height = 35)
```

```{r}
#| echo: false
#| fig-cap: "Figure 5. A network diagram generated from pre-loaded igraph object with pre-specified weights."
#| fig-align: "center"
#| out.width: "70%"
knitr::include_graphics("network_preload/fig6.png")
```

Weights information is inherited by `ggsem`.

### Community-Aware Styling: {.unnumbered}

```{r}
# Complete network analysis workflow
set.seed(123)
g <- sample_pa(20, power = 1.2, m = 2)  # Preferential attachment

# Analytical steps in igraph
V(g)$degree <- degree(g)
V(g)$betweenness <- betweenness(g)
communities <- cluster_walktrap(g)
V(g)$community <- communities$membership
plot(g)
```

```{r}
#| eval: false
# Interactive refinement in ggsem
ggsem(object = g, width = 45, height = 45)
```

```{r}
#| echo: false
#| fig-cap: "Figure 6. A network diagram generated from pre-loaded igraph object with pre-specified community information, which is used to perform clustering on the nodes based on their community properties in the app."
#| fig-align: "center"
#| out.width: "80%"
knitr::include_graphics("network_preload/fig7.png")
```

You can perform clustering by assigning unique color to each cluster of the nodes because `g` contains information about community.

## 2. Loading `qgraph` network objects {.unnumbered}

Additionally, the `ggsem` package provides support for `qgraph` objects for plotting networks.

### Direct `qgraph` Network Import {.unnumbered}

Load `qgraph` network objects directly into `ggsem`. Make sure to specify `type` argument as `network`.

```{r}
#| message: false
#| warning: false
#| fig-width: 5
#| fig-height: 5
#| fig-align: center
library(qgraph)
library(ggsem)

# Create correlation network from mtcars data
cor_matrix <- cor(mtcars)
qgraph_net <- qgraph(cor_matrix, graph = "pcor")

class(qgraph_net) # class of the object
```

```{r}
#| eval: false
# Import directly into ggsem
ggsem(object = qgraph_net, type = 'network')
```

```{r}
#| echo: false
#| fig-cap: "Figure 7. A network diagram generated from pre-loaded qgraph object."
#| fig-align: "center"
#| out.width: "90%"
knitr::include_graphics("network_preload/fig8.png")
```

Through interactive parameter visualization, you can modify properties of a specific node, edge or label:

```{r}
#| echo: false
#| fig-cap: "Figure 8. A network diagram generated from pre-loaded qgraph object, with some nodes having different colors."
#| fig-align: "center"
#| out.width: "75%"
knitr::include_graphics("network_preload/fig9.png")
```

### Practical `qgraph` Network Examples {.unnumbered}

#### Correlation Network with Thresholding {.unnumbered}

```{r}
#| fig-width: 5
#| fig-height: 5
#| fig-align: center
# Correlation network with edge thresholding
cor_matrix <- cor(mtcars)

qgraph_net <- qgraph(cor_matrix,
       graph = "cor",
       minimum = 0.5,  # Hide edges below this threshold
       maximum = 1,    # Upper threshold
       layout = "spring",
       edge.width = 2,
       label.cex = 0.8,
       labels = colnames(mtcars))
```

```{r}
#| eval: false
ggsem(object = qgraph_net, type = 'network')
```

```{r}
#| echo: false
#| fig-cap: "Figure 9. A network diagram generated from pre-loaded qgraph object."
#| fig-align: "center"
#| out.width: "90%"
knitr::include_graphics("network_preload/fig10.png")
```

#### Partial Correlation Network {.unnumbered}

```{r}
#| fig-width: 5
#| fig-height: 5
#| fig-align: center
# Partial correlation network controlling for other variables
qgraph_net <- qgraph(cor_matrix,
       graph = "pcor",  # Partial correlations
       layout = "spring",
       sampleSize = nrow(mtcars),  # Important for pcor calculations
       labels = colnames(mtcars),
       theme = "colorblind")

plot(qgraph_net)
```

```{r}
#| eval: false
ggsem(object = qgraph_net, type = 'network')
```

```{r}
#| echo: false
#| fig-cap: "Figure 10. A network diagram generated from pre-loaded qgraph object."
#| fig-align: "center"
#| out.width: "90%"
knitr::include_graphics("network_preload/fig11.png")
```

#### Glasso Network (Regularized Partial Correlations) {.unnumbered}

```{r}
#| fig-width: 4
#| fig-height: 4
#| fig-align: center
# Regularized partial correlation network using graphical lasso
qgraph_net <- qgraph(cor_matrix,
       graph = "glasso",
       layout = "spring",
       sampleSize = nrow(mtcars), # Required for glasso estimation
       tuning = 0.5,  # Regularization parameter
       labels = colnames(mtcars),
       theme = "colorblind")

plot(qgraph_net)
```

```{r}
#| eval: false
ggsem(object = qgraph_net, type = 'network')
```

```{r}
#| echo: false
#| fig-cap: "Figure 11. A network diagram generated from pre-loaded qgraph object."
#| fig-align: "center"
#| out.width: "90%"
knitr::include_graphics("network_preload/fig12.png")
```

### Preserved `qgraph` Features {.unnumbered}

#### Network Properties Maintained: {.unnumbered}

-   **Edge weights** and correlation values

-   **Node positions** from qgraph layout algorithms

-   **Color schemes** for nodes and edges

-   **Thresholding** and filtering settings

-   **Edge labels** and correlation coefficients

#### Layout Preservation: {.unnumbered}

-   Spring, circle, and other `qgraph` layouts are maintained

-   Node positioning transferred accurately to `ggsem`

-   Option to further refine layout interactively in `ggsem`

### What are not preserved {.unnumbered}

#### Title {.unnumbered}

-   Does not inherit title, so you must re-create it if necessary.

#### Legend {.unnumbered}

-   `ggsem` does not create legend.

#### Polygon {.unnumbered}

-   Polygon shapes to indicate cluster-based group

## 3. Loading `network` Objects {.unnumbered}

Finally, the `ggsem` package provides support for `network` objects for plotting networks.

### Direct Network Object Import {.unnumbered}

Load network objects directly into `ggsem`:

```{r}
#| warning: false
#| message: false

library(network)
library(ggsem)

# Create a simple network object
net <- network.initialize(10)  # 10 nodes
network::add.edges(net, tail = 1:9, head = 2:10)  # Create a chain
network.vertex.names(net) <- letters[1:10]

class(net)  # Returns "network"
plot(net)
```

```{r}
#| eval: false
# Import directly into ggsem
ggsem(object = net, width = 35, height = 35)
```

```{r}
#| echo: false
#| fig-cap: "Figure 12. A network diagram generated from pre-loaded network object. Network layout is set to be circular."
#| fig-align: "center"
#| out.width: "65%"
knitr::include_graphics("network_preload/fig13.png")
```
